# README

## Описание
Этот проект демонстрирует два подхода к обработке асинхронных задач в многопоточной среде с использованием C++:
- `example_add_async.cpp` — реализация с использованием `std::async` и `std::future`.
- `example_add_package.cpp` — реализация с использованием `std::packaged_task`.

Обе программы запускают поток сервера, который извлекает задачи из очереди и выполняет их, а также поток клиента, который добавляет задачи в очередь.

---

## Файл: `example_add_async.cpp`

### Описание
Этот файл использует `std::async` для асинхронного выполнения задач, а `std::queue<std::pair<size_t, std::future<int>>>` служит для хранения задач. `std::mutex` используется для синхронизации доступа к общим ресурсам.

### Как работает код:
1. **Функция `f(int x, int y)`** – выполняет `std::pow(x, y)` с задержкой в 2 секунды, имитируя длительный процесс.
2. **Функция `server_thread`**
   - Проверяет очередь задач.
   - Если в очереди есть задачи, извлекает последнюю, выполняет её и сохраняет результат в `std::unordered_map<int, int> results`.
   - Спит 50 мс перед следующей проверкой (чтобы не загружать CPU).
3. **Функция `add_task_thread`**
   - Создает `std::async(std::launch::deferred, f, 2, 4);`, который выполняется только при вызове `.get()`.
   - Добавляет задачу в очередь `tasks`.
   - Ожидает выполнения задачи и выводит результат.
4. **`main`**
   - Запускает сервер и клиент в отдельных потоках.
   - После выполнения задачи останавливает сервер и завершает выполнение программы.


---

## Файл: `example_add_package.cpp`

### Описание
Этот файл использует `std::packaged_task`, который позволяет упаковывать функции и управлять их выполнением вручную. Очередь задач `std::queue<std::packaged_task<int()>>` управляется с помощью `std::mutex` и `std::condition_variable`.

### Как работает код:
1. **Функция `f(int x, int y)`** – выполняет `std::pow(x, y)` с задержкой в 2 секунды.
2. **Функция `server_thread`**
   - Использует `std::condition_variable` для ожидания новых задач.
   - Извлекает задачу из очереди, выполняет её и освобождает поток для следующей.
3. **Функция `add_task_thread`**
   - Создает `std::packaged_task<int()>`, оборачивающий `f(2,4)`.
   - Получает `std::future<int>` для ожидания результата.
   - Добавляет задачу в очередь и уведомляет серверный поток.
   - Ждет выполнения и выводит результат.
4. **`main`**
   - Запускает сервер и клиент в отдельных потоках.
   - После выполнения задачи останавливает сервер и завершает выполнение программы.

---

## Компиляции
Для компиляции примеров используйте команды:
```sh
 cmake -B build -S . -DCMAKE_CXX_COMPILER=g++
 cmake --build build/
```

## Запуск
Для запуска примеров используйте команду:
```sh
 ./build/bin/<compile>/<name_program>
```
- compile - имя компилятора
- name_program - имя программы, образуется от имени исходного файла
---

